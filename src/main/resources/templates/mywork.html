<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>내 근무</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    #workTable {
      margin-top: 20px;
    }
    .default-row {
      background-color: #f8f9fa;
    }
  </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <div class="container">
    <a class="navbar-brand" href="#">Nexus.team</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="#" id="employeeListBtn">구성원</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">급여</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/work">근무</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">휴가</a>
        </li>
      </ul>
    </div>
    <div class="d-flex align-items-center">
      <span class="me-3" id="userName"></span>
      <a class="btn btn-outline-danger" href="/logout">로그아웃</a>
    </div>
  </div>
</nav>

<div class="container mt-5">
  <h2>이번 주 내 근무 기록</h2>
  <table class="table table-striped" id="workTable">
    <thead>
    <tr>
      <th>요일</th>
      <th>날짜</th>
      <th>근무 시간</th>
      <th>급여 유형</th>
    </tr>
    </thead>
    <tbody>
    <!-- 기본적인 요일과 날짜 정보 -->
    </tbody>
  </table>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const token = localStorage.getItem('Authorization'); // 또는 다른 방식으로 토큰을 가져옵니다

    // 요일과 날짜 기본 데이터 생성
    const today = new Date();
    const weekDays = ['월요일', '화요일', '수요일', '목요일', '금요일', '토요일', '일요일'];
    const startOfWeek = new Date(today.setDate(today.getDate() - today.getDay() + 1)); // 월요일로 설정

    const tableBody = document.querySelector('#workTable tbody');
    tableBody.innerHTML = ''; // 기존 내용 제거

    for (let i = 0; i < 7; i++) {
      const currentDay = new Date(startOfWeek);
      currentDay.setDate(currentDay.getDate() + i);

      const row = document.createElement('tr');
      row.classList.add('default-row');

      const dayCell = document.createElement('td');
      dayCell.textContent = weekDays[i];
      row.appendChild(dayCell);

      const dateCell = document.createElement('td');
      dateCell.textContent = currentDay.toISOString().split('T')[0]; // YYYY-MM-DD 포맷
      row.appendChild(dateCell);

      const workTimeCell = document.createElement('td');
      workTimeCell.textContent = '미등록'; // 기본 값
      row.appendChild(workTimeCell);

      const salaryTypeCell = document.createElement('td');
      salaryTypeCell.textContent = '미등록'; // 기본 값
      row.appendChild(salaryTypeCell);

      tableBody.appendChild(row);
    }

    // API로 데이터 가져오기
    fetch('/api/work/week', {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${token}`,
      }
    })
            .then(response => response.json())
            .then(data => {
              if (data.data && Array.isArray(data.data.content)) {
                data.data.content.forEach(work => {
                  // JSON에서 work_date를 Date 객체로 변환
                  const workDate = new Date(work.work_date); // JSON 응답에서 날짜는 work.work_date에 있음
                  const formattedDate = workDate.toISOString().split('T')[0]; // 'YYYY-MM-DD' 형식으로 변환

                  // work_time을 'H시간 M분' 형식으로 변환
                  const [hours, minutes] = work.work_time.split(' : ').map(Number);
                  const formattedWorkTime = `${hours}시간 ${minutes}분`;

                  // 급여 타입을 한국어로 변환
                  let salaryType;
                  switch (work.salary_type) {
                    case 'CUSTOMIZED_WORK':
                      salaryType = '맞춤 근무';
                      break;
                    case 'VACATION':
                      salaryType = '휴무';
                      break;
                    default:
                      salaryType = '기타'; // 필요에 따라 추가적인 급여 타입 처리
                  }

                  // 테이블의 각 행을 찾고 날짜가 일치하는지 확인
                  const rows = tableBody.querySelectorAll('tr');
                  rows.forEach(row => {
                    const dateCell = row.querySelector('td:nth-child(2)');
                    if (dateCell.textContent === formattedDate) {
                      row.querySelector('td:nth-child(3)').textContent = formattedWorkTime; // 근무 시간 업데이트
                      row.querySelector('td:nth-child(4)').textContent = salaryType; // 급여 타입 업데이트
                    }
                  });
                });
              } else {
                console.error('Invalid data format:', data);
              }
            })
            .catch(error => {
              console.error('Error fetching data:', error);
            });


  });
</script>
</body>
</html>
